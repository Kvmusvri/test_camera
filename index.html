<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Камера с фокусировкой и ISO</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #000; }
        video { 
            width: 100%; 
            max-width: 400px; 
            border: 1px solid black; 
        }
        canvas { display: none; }
        img { margin-top: 10px; max-width: 100%; border: 1px solid black; }
        button { 
            background: rgba(255, 255, 255, 0.7); 
            border-radius: 50%; 
            border: none; 
            width: 80px; 
            height: 80px; 
            cursor: pointer; 
            position: absolute; 
            bottom: 20px; 
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        input[type="range"] {
            width: 100%;
            max-width: 400px;
            margin-top: 10px;
            display: block;
        }
    </style>
</head>
<body>
    <h1 style="color: white;">Сфотографируйте что-то!</h1>
    <div style="position: relative;">
        <video id="video" autoplay playsinline muted></video>
        <button id="snap"></button> <!-- Кнопка сфотографировать -->
    </div>
    <input type="range" id="focus-range" min="0" max="100" value="50" step="1" />
    <input type="range" id="iso-range" min="100" max="800" value="400" step="100" />
    <canvas id="canvas"></canvas>
    <img id="photo" alt="Сфотографированное изображение">

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const photo = document.getElementById('photo');
        const snapButton = document.getElementById('snap');
        const focusRange = document.getElementById('focus-range');
        const isoRange = document.getElementById('iso-range');

        let currentStream;
        let track;

        async function startCamera() {
            try {
                // Запрашиваем доступ к камере с тыльной камерой
                currentStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                video.srcObject = currentStream;
                track = currentStream.getVideoTracks()[0];
                
                // Устанавливаем начальные значения фокуса и ISO
                setManualFocus(50);
                setISO(400);
            } catch (err) {
                console.error("Ошибка доступа к камере:", err);
                alert("Не удалось получить доступ к камере. Убедитесь, что камера подключена и разрешите доступ.");
            }
        }

        // Установка фокуса
        function setManualFocus(value) {
            const focusValue = value / 100; // Нормализуем значение (0-1)
            track.applyConstraints({
                advanced: [{ focusMode: 'manual', focusDistance: focusValue }]
            });
        }

        // Установка ISO (если поддерживается)
        function setISO(value) {
            track.applyConstraints({
                advanced: [{ iso: value }]
            });
        }

        // Инициализация камеры
        startCamera();

        // Обработчик захвата изображения
        snapButton.addEventListener('click', () => {
            const width = video.videoWidth;
            const height = video.videoHeight;

            if (width && height) {
                canvas.width = width;
                canvas.height = height;
                context.drawImage(video, 0, 0, width, height);
                const dataURL = canvas.toDataURL('image/png');
                photo.setAttribute('src', dataURL);
            } else {
                console.error("Не удалось получить размеры видео.");
                alert("Не удается сделать снимок. Убедитесь, что камера работает.");
            }
        });

        // Регулировка фокуса
        focusRange.addEventListener('input', () => {
            setManualFocus(focusRange.value);
        });

        // Регулировка ISO
        isoRange.addEventListener('input', () => {
            setISO(isoRange.value);
        });

    </script>
</body>
</html>
