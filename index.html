<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Камера</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/telegram-web-app/1.1.0/telegram-web-app.css" rel="stylesheet">
    <style>
        body { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            background-color: #000; 
            font-family: 'Arial', sans-serif;
        }
        video { 
            width: 100%; 
            max-width: 400px; 
            border: 1px solid black; 
        }
        canvas { display: none; }
        img { margin-top: 10px; max-width: 100%; border: 1px solid black; }
        button { 
            background: rgba(255, 255, 255, 0.7); 
            border-radius: 50%; 
            border: none; 
            width: 80px; 
            height: 80px; 
            cursor: pointer; 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); /* Центрирование кнопки */
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        button:focus {
            outline: none; /* Убираем контур при фокусе */
        }
    </style>
</head>
<body>
    <div style="position: relative;">
        <video id="video" autoplay playsinline muted></video>
        <button id="snap"></button> <!-- Кнопка сфотографировать -->
    </div>
    <canvas id="canvas"></canvas>
    <img id="photo" alt="Сфотографированное изображение">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/telegraph/1.0.0/telegraph.min.js"></script>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const photo = document.getElementById('photo');
        const snapButton = document.getElementById('snap');

        let currentStream;

        async function startCamera() {
            try {
                // Запрашиваем доступ к камере с тыльной камерой
                currentStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                video.srcObject = currentStream;

                // Улучшение качества с помощью библиотеки
                applyImageEnhancement();
            } catch (err) {
                console.error("Ошибка доступа к камере:", err);
                alert("Не удалось получить доступ к камере. Убедитесь, что камера подключена и разрешите доступ.");
            }
        }

        function applyImageEnhancement() {
            // Пример применения улучшения качества, замените это на вашу логику
        }

        // Инициализация камеры
        startCamera();

        // Обработчик захвата изображения
        snapButton.addEventListener('click', () => {
            const width = video.videoWidth;
            const height = video.videoHeight;

            if (width && height) {
                canvas.width = width;
                canvas.height = height;
                context.drawImage(video, 0, 0, width, height);
                
                // Применение улучшения изображений (например, с помощью библиотеки)
                // Для примера лишь обрезка
                context.drawImage(video, 0, 0, width, height);
                
                // Получаем изображение
                const dataURL = canvas.toDataURL('image/png');
                photo.setAttribute('src', dataURL);
            } else {
                console.error("Не удалось получить размеры видео.");
                alert("Не удается сделать снимок. Убедитесь, что камера работает.");
            }
        });
    </script>
</body>
</html>
