<!DOCTYPE html> 
<html lang="ru"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Веб-камера с переключением</title> 
    <style> 
        body { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0; 
            position: relative; 
            height: 100vh; 
            overflow: hidden; 
        } 
        video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover;  /* covers the video area */
            position: absolute; 
            top: 0; 
            left: 0; 
        } 
        canvas { display: none; } 
        img { margin-top: 10px; max-width: 100%; border: 1px solid black; } 
        button { 
            border: none; 
            border-radius: 50%; 
            width: 70px; 
            height: 70px; 
            background-color: rgba(255, 255, 255, 0.3); /* еле прозрачный фон */ 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); 
            cursor: pointer; 
            position: absolute; 
            bottom: 20px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            left: 50%; /* Центрируем по горизонтали */
            transform: translateX(-50%);
        } 
        .gallery {
            position: absolute;
            top: 10px;
            left: 40%; /* Смещаем галерею чуть левее */
            transform: translateX(-50%);
            display: flex;
            flex-direction: row;
            overflow-x: auto;
            z-index: 1; /* Делаем галерею над видео */
        }
        .gallery img {
            width: 100px;
            height: auto;
            margin: 0 5px;
            border: 2px solid black;
            border-radius: 5px;
        }
    </style> 
</head> 
<body> 
    <video id="video" autoplay playsinline muted></video> 
    <div class="gallery" id="gallery"></div>
    <button id="snap"></button> 
    <canvas id="canvas"></canvas> 
    <img id="photo" alt="Сфотографированное изображение" style="display:none;"> 
    <script> 
        const video = document.getElementById('video'); 
        const canvas = document.getElementById('canvas'); 
        const context = canvas.getContext('2d'); 
        const photo = document.getElementById('photo'); 
        const gallery = document.getElementById('gallery'); 

        let currentStream; 

        async function startCamera(facingMode) { 
            if (currentStream) { 
                const tracks = currentStream.getTracks(); 
                tracks.forEach(track => track.stop()); 
            } 
            currentStream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: facingMode, 
                    width: {min: 640, ideal: 1920}, 
                    height: {min: 480, ideal: 1080}, 
                    aspectRatio: 4 / 3, 
                    frameRate: {min: 20} 
                } 
            }); 
            video.srcObject = currentStream; 
        } 

        document.getElementById('snap').addEventListener('click', () => { 
            canvas.width = video.videoWidth; 
            canvas.height = video.videoHeight; 
            context.drawImage(video, 0, 0, canvas.width, canvas.height); 

            let imgData = context.getImageData(0, 0, canvas.width, canvas.height); 
            let data = imgData.data; 

            for (let i = 0; i < data.length; i += 4) {
                data[i] = clamp(data[i] + 5); // Красный
                data[i + 1] = clamp(data[i + 1] + 5); // Зеленый 
                data[i + 2] = clamp(data[i + 2] + 5); // Синий 
            } 

            context.putImageData(imgData, 0, 0); // Рисуем улучшенное изображение для итогового 
            photo.src = canvas.toDataURL(); // Обновляем изображение для отображения 

            // Добавляем в галерею
            const newImg = document.createElement('img');
            newImg.src = photo.src;
            gallery.appendChild(newImg);
        }); 

        function clamp(value) { 
            return Math.max(0, Math.min(255, value)); // Ограничиваем значение от 0 до 255 
        } 

        startCamera('environment'); 
    </script> 
</body> 
</html>
